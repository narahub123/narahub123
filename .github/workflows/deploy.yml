# .github/workflows/deploy.yml

name: Deploy Multiple Projects to GitHub Pages

# main ë¸Œëœì¹˜ì— push ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
on:
  push:
    branches:
      - main # ì‚¬ìš©í•˜ëŠ” ì£¼ ë¸Œëœì¹˜ ì´ë¦„ (main ë˜ëŠ” master)

# ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ì— í•„ìš”í•œ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.
permissions:
  contents: write # gh-pages ë¸Œëœì¹˜ì— ì½”ë“œë¥¼ í‘¸ì‹œí•˜ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: âœ… Checkout
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "22" # ì‚¬ìš©í•˜ëŠ” ë…¸ë“œ ë²„ì „
          cache: "npm"
          cache-dependency-path: "**/package-lock.json" # ìºì‹œë¥¼ ìœ„í•´ ì—¬ëŸ¬ lock íŒŒì¼ ê²½ë¡œ ì§€ì •

      # --- project1 ë¹Œë“œ ---
      - name: ğŸ“¦ Install and Build Project 1
        run: |
          cd mini-projects/react-project
          npm install
          CI=false npm run build
          cp public/404.html build/404.html
      # --- project2 ë¹Œë“œ ---
      - name: ğŸ“¦ Install and Build Project 2
        env:
          REACT_APP_SERVER_URL: ${{ secrets.REACT_APP_SERVER_URL }}
          REACT_APP_GOOGLE_CLIENT_ID: ${{ secrets.REACT_APP_GOOGLE_CLIENT_ID }}
          REACT_APP_KAKAO_CLIENT_ID: ${{ secrets.REACT_APP_KAKAO_CLIENT_ID }}
          REACT_APP_NAVER_CLIENT_ID: ${{ secrets.REACT_APP_NAVER_CLIENT_ID }}
          REACT_APP_GITHUB_CLIENT_ID: ${{ secrets.REACT_APP_GITHUB_CLIENT_ID }}
        run: |
          cd mini-projects/chatting-app/client
          npm install
          CI=false npm run build
          cp public/404.html build/404.html
        # --- project2 ë¹Œë“œ ---
      - name: ğŸ“¦ Install and Build Project 3
        env:
          REACT_APP_SERVER_URL: ${{ secrets.REACT_APP_SERVER_URL }}
          REACT_APP_FIREBASE_API_KEY: ${{ secrets.REACT_APP_FIREBASE_API_KEY }}
          REACT_APP_FIREBASE_AUTH_DOMAIN: ${{ secrets.REACT_APP_FIREBASE_AUTH_DOMAIN }}
          REACT_APP_FIREBASE_DATABASE_URL: ${{ secrets.REACT_APP_FIREBASE_DATABASE_URL }}
          REACT_APP_FIREBASE_PROJECT_ID: ${{ secrets.REACT_APP_FIREBASE_PROJECT_ID }}
          REACT_APP_FIREBASE_STORAGE_BUCKET: ${{ secrets.REACT_APP_FIREBASE_STORAGE_BUCKET }}
          REACT_APP_FIREBASE_MESSAGIN_SENDER_ID: ${{ secrets.REACT_APP_FIREBASE_MESSAGIN_SENDER_ID }}
          REACT_APP_FIREBASE_APP_ID: ${{ secrets.REACT_APP_FIREBASE_APP_ID }}
          REACT_APP_FIREBASE_MEASUREMENT_ID: ${{ secrets.REACT_APP_FIREBASE_MEASUREMENT_ID }}
        run: |
          cd mini-projects/yunspeech/frontend
          npm install
          CI=false npm run build
          cp public/404.html build/404.html

      # --- ë¹Œë“œ ê²°ê³¼ë¬¼ì„ í•œ ê³³ìœ¼ë¡œ ëª¨ìœ¼ê¸° ---
      - name: ğŸ“‚ Prepare deployment directory
        run: |
          mkdir -p deploy/react-project
          mkdir -p deploy/chatting-app
          mkdir -p deploy/yunspeech
          # ì˜¬ë°”ë¥¸ ì†ŒìŠ¤ ê²½ë¡œë¡œ ìˆ˜ì •
          cp -r mini-projects/react-project/build/* deploy/react-project/
          cp -r mini-projects/chatting-app/client/build/* deploy/chatting-app/
          cp -r mini-projects/yunspeech/frontend/build/* deploy/yunspeech/

          # ë£¨íŠ¸ ê²½ë¡œì— README.md ê°™ì€ íŒŒì¼ì„ ë‘ê³  ì‹¶ë‹¤ë©´ ì—¬ê¸°ì— ì¶”ê°€
          # cp README.md deploy/

      # --- gh-pages ë¸Œëœì¹˜ë¡œ ë°°í¬ ---
      - name: ğŸš€ Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./deploy # ë°°í¬í•  í´ë”ë¥¼ ì§€ì •
          # user_name: 'github-actions[bot]' # ì»¤ë°‹ ì‚¬ìš©ì ì´ë¦„ (ì„ íƒ)
          # user_email: 'github-actions[bot]@users.noreply.github.com' # ì»¤ë°‹ ì‚¬ìš©ì ì´ë©”ì¼ (ì„ íƒ)
          # cname: your-custom-domain.com # ì»¤ìŠ¤í…€ ë„ë©”ì¸ì´ ìˆì„ ê²½ìš° (ì„ íƒ)
