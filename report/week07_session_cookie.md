# 세션(Session)과 쿠키(Cookie) 기반 인증 흐름 이해

## 1. 상태 유지 전략이 필요한 이유
- **웹은 연결되어 있지 않음을 주의할 것!!!**
- HTTP는 무상태(stateless) 프로토콜  
  - 서버가 요청 간 상태를 기억하지 않음  
  - 요청마다 독립적으로 처리됨  
- HTTP는 비연결(connectionless) 방식  
  - 요청-응답 후 연결 종료  
  - 매 요청 시 새 연결 필요  
- 웹 서비스는 사용자 상태(로그인, 장바구니 등) 유지 필요  
- 상태를 유지하지 않으면 매 요청 인증 반복해야 함 → 불편, 비효율  
- 따라서, 상태 유지 전략(세션, 쿠키 등) 필요  

## 2. 세션(Session)
- 서버가 사용자별 상태(인증 정보 등) 저장  
- 클라이언트에는 세션 ID만 쿠키로 전달  
- 서버는 세션 ID로 상태 조회, 인증 유지  

### 특징
- 인증 정보 서버 저장 → 보안성 높음  
- 서버 자원 사용 많음 → 확장 시 세션 동기화 필요  
- 클라이언트는 세션 ID만 보유  
- 세션 만료 서버가 직접 관리  

### 사용법
- 로그인 성공 시 서버에서 세션 생성 및 세션 ID 발급  
- HttpOnly, Secure 쿠키에 세션 ID 저장 후 클라이언트 전달  
- 클라이언트는 요청 시 세션 ID 쿠키 자동 포함  
- 서버는 세션 ID로 상태 조회 후 요청 처리  

## 3. 쿠키(Cookie)
- 인증 정보를 JWT 등 토큰 형태로 클라이언트 쿠키에 저장  
- 서버는 쿠키 토큰 검증해 인증 판단  
- 상태를 서버에 저장하지 않음 (stateless)  

### 특징
- 인증 정보 클라이언트 저장 → 서버 부하 적음  
- 토큰 변조·탈취 위험 있음 → 서명·암호화로 방어  
- 쿠키 크기 제한 약 4KB  
- 토큰에 만료 정보 포함 → 클라이언트가 만료 시 재로그인  
- 키-값 쌍으로 구성 

### 사용법
- 로그인 성공 시 서버가 JWT 토큰 생성  
- HttpOnly, Secure 쿠키에 토큰 저장 후 클라이언트 전달  
- 클라이언트는 모든 요청에 쿠키 자동 포함  
- 서버는 토큰 서명·만료 검증 후 인증 처리  

### 용례 
- 오늘 하루 팝업창이 뜨지 않게 하는 것 

## 4. 세션 vs 쿠키 비교

| 구분           | 세션(Session)                      | 쿠키(Cookie)                        |
|----------------|----------------------------------|-----------------------------------|
| 저장 위치       | 서버                             | 클라이언트(브라우저)              |
| 인증 상태 확인 | 세션 ID로 서버 세션 저장소 조회 | 쿠키 내 토큰 서명·만료 검증       |
| 서버 부하       | 높음                             | 낮음                             |
| 보안성         | 서버 직접 관리로 안전성 높음      | 토큰 변조·탈취 위험 존재, 서명으로 보호 |
| 확장성         | 세션 동기화 필요 시 복잡도 증가   | 토큰 자체에 정보 포함, 확장성 우수 |
| 만료 관리      | 서버가 직접 관리                 | 토큰에 만료 정보 포함             |
| 데이터 크기 제한 | 제한 없음 (서버 자원 따라 다름)  | 약 4KB (쿠키 크기 제한)           |

## 5. 로그인 구조 적용 예시

### 5-1. 세션 기반 로그인 흐름
1. 클라이언트 → 로그인 정보(아이디, 비밀번호) 전송  
2. 서버 → 인증 성공 시 세션 생성 및 세션 ID 발급  
3. 서버 → Set-Cookie 헤더로 세션 ID, HttpOnly, Secure 쿠키 전달  
4. 클라이언트 → 모든 요청에 세션 ID 쿠키 자동 포함  
5. 서버 → 세션 ID로 세션 저장소 조회 후 인증 상태 확인, 요청 처리  
6. 세션 만료 시 → 클라이언트 재로그인 필요  

### 5-2. 쿠키 기반 로그인 흐름
1. 클라이언트 → 로그인 정보 전송  
2. 서버 → 인증 성공 시 JWT 토큰 생성  
3. 서버 → Set-Cookie 헤더로 JWT 토큰, HttpOnly, Secure 쿠키 전달  
4. 클라이언트 → 모든 요청에 쿠키 자동 포함  
5. 서버 → 토큰 서명 및 만료 검증 후 인증 처리  
6. 토큰 만료 시 → 클라이언트 재로그인 필요  

# ✅ Session vs Cookie 선택 가이드

---

## 1️⃣ 프로젝트 유형별 권장 사항

| 프로젝트 유형                 | 세션 (Session) | 쿠키 (Cookie) | 설명 |
|-----------------------------|----------------|---------------|------|
| 웹 기반 로그인 시스템        | ✅ 권장         | ⚠️ 보조 용도    | 로그인 상태 유지에 적합 |
| 쇼핑몰 / 결제 시스템         | ✅ 필수         | ⚠️ 설정 저장 용도 | 민감 정보 서버 보관 필수 |
| 정적 웹사이트 (블로그 등)     | ❌ 부적합       | ✅ 권장         | 테마, 언어 설정 등 |
| 광고/분석 추적 시스템        | ❌ 부적합       | ✅ 필수         | 사용자 식별자 저장용 |
| 모바일 앱 + API 서버         | ❌ 비권장       | ✅ JWT 또는 쿠키 | 세션은 브라우저 기반 |
| 멀티도메인 / SSO 환경        | ❌ 제약 많음    | ✅ 권장 또는 JWT | 세션은 도메인 공유 불가 |

---

## 2️⃣ 성능 및 보안 특성 비교

| 항목               | 세션 (Session)                         | 쿠키 (Cookie)                          |
|--------------------|----------------------------------------|----------------------------------------|
| 저장 위치          | 서버 (메모리 또는 DB)                 | 클라이언트 (브라우저)                 |
| 보안성             | 🔒 높음 (노출 없음)                    | 🔓 낮음 (변조/탈취 위험)              |
| 저장 용량          | 제한 없음                              | 약 4KB 제한 (브라우저마다 다름)        |
| 네트워크 전송 비용 | 작음 (세션 ID만 전송됨)               | 큼 (모든 요청에 포함됨)               |
| 만료 제어          | 서버에서 제어 가능 (정밀함)            | `Max-Age`, `Expires`로 제어 가능       |
| 서버 자원 소비     | 많음 (세션 저장소 필요)                | 없음 (Stateless)                      |
| 확장성             | 낮음 (세션 공유 필요 - 예: Redis)       | 높음 (서버 간 상태 공유 필요 없음)     |

---

## 3️⃣ 기술 스택별 권장 방식

| 기술 스택 / 환경            | 세션 권장 여부 | 쿠키 권장 여부 | 비고 |
|-----------------------------|----------------|----------------|------|
| Express.js (Node.js)        | ✅ `express-session` 사용 | ✅ `cookie-parser` 병행 | 세션 ID를 쿠키에 저장 |
| NestJS                      | ✅ `@nestjs/session` 사용 | ✅ 가능 | JWT와 병행 사용 빈도 높음 |
| Django                      | ✅ 기본 세션 시스템 내장 | ✅ 가능 (`request.COOKIES`) | 세션 기반 인증이 기본 |
| Spring Boot                 | ✅ `HttpSession` 지원 | ✅ `@CookieValue` 사용 | Spring Security와 함께 사용 |
| React SPA + REST API 서버   | ⚠️ 사용 가능하지만 제약 많음 | ✅ 권장 (또는 JWT) | CORS, SameSite 설정 필요 |
| Next.js (SSR 기반 웹앱)     | ✅ SSR에서 세션 활용 유리 | ✅ `next-cookies` 등 활용 | 서버 측 렌더링 시 편리 |
| Flutter / React Native 앱  | ❌ 세션 사용 불가 | ✅ 토큰 또는 쿠키 저장 | 로컬 스토리지 or SecureStorage 사용 |
| 서버리스 환경 (Cloud Functions 등) | ❌ 상태 유지 불가 | ✅ Stateless 쿠키 또는 JWT | 세션 저장소가 없음 |

---

## 🔄 요약

| 항목             | 세션 (Session)              | 쿠키 (Cookie)               |
|------------------|-----------------------------|-----------------------------|
| 보안성           | 🔒 높음                      | 🔓 낮음 (암호화/HttpOnly 필수) |
| 서버 자원 사용   | ⛽ 필요 (메모리, DB 등)       | 💨 없음                     |
| 확장성           | ❌ 낮음 (세션 공유 필요)       | ✅ 높음 (Stateless 구조)      |
| 적합한 용도      | 로그인, 인증, 민감 정보 처리 | 사용자 설정, 자동 로그인 등  |
| 대표 사례        | 로그인 세션, 장바구니, 결제   | 테마, 언어, 광고 식별자     |

---

## 🔧 보통의 실무 패턴

- **세션 + 쿠키 조합**
  - 쿠키에는 **세션 ID만 저장**
  - 실제 데이터는 서버 세션 저장소 (메모리/Redis/DB 등)에 저장
  - 보안을 위해 `HttpOnly`, `Secure`, `SameSite` 속성 적용

- **SPA / 모바일 앱에서는 JWT 기반 인증이 일반적**
  - 세션보다는 쿠키 또는 로컬 스토리지에 JWT 저장 후 사용


---

## 참고 사이트
- [Session vs Cookie](https://velog.io/@sammy0329/Session-vs-Cookie)  
- [쿠키 vs 세션](https://sung-98.tistory.com/216)
