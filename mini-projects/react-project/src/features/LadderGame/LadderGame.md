# 🎲 사다리 타기 게임 (Ladder Game)

## 1. 개요

BFS/DFS 알고리즘 학습과 실습을 목적으로 시작한 사다리 타기 게임 프로젝트입니다.  
참가자 수와 당첨자 수를 설정하면, 랜덤으로 사다리를 생성하고 당첨자를 선정하여 경로를 따라가는 애니메이션을 제공합니다.  
초기에는 BFS/DFS를 시도했으나, 이후 Greedy 알고리즘으로 단순화하여 구현하였습니다.

---

## 2. 주요 기능 및 기술 스택

### 주요 기능

- 참가자 수 및 당첨자 수 선택
- 당첨자 랜덤 결정
- 랜덤 사다리 생성
- 경로 이동 애니메이션 구현

### 기술 스택

- Frontend: React
- 스타일링: Tailwind CSS
- 애니메이션 및 경로 그리기: Canvas API, requestAnimationFrame

---

## 3. 프로젝트 구조

LadderGame  
├── components # UI 컴포넌트 모음  
├── constants # 상수 정의  
├── context # 상태 관리용 Context  
├── hooks # 커스텀 훅 (예: useGenerateLadder, useGeneratePaths)  
├── types # 타입 정의  
├── utils # 유틸리티 함수 (사다리 생성, 경로 계산 등)  
├── index.ts # 엔트리 포인트 (모듈 export)  
├── LadderGame.tsx # 메인 컴포넌트  
└── LadderGame.md # 개발 기록 문서

---

## 4. 구현 과정 및 알고리즘 흐름

### 4.1 사다리 생성 (`useGenerateLadder`)

- 참가자 위치 사이에 임의의 개수만큼 다리를 생성합니다.
- 다리의 y축 위치는 서로 20px 이상 간격을 두어 중복되지 않도록 최대 100회 재시도하며 배치합니다.
- 다리는 두 참가자 x 좌표 사이에서 y 좌표만 랜덤 결정됩니다.
- 생성된 다리들은 상태에 저장되어 경로 탐색과 애니메이션에 활용됩니다.

### 4.2 경로 탐색 (useGeneratePaths)

- 사용자가 선택한 참가자의 시작 위치에서 경로 추적을 시작합니다.

- 현재 위치 아래에 같은 x 좌표를 가진 다리가 있으면 내려가고, 다리가 없으면 최하단까지 직선으로 이동합니다.

- 다리를 만나면 좌우로 연결된 다리 위치도 따라가면서 경로를 만듭니다.

- 결과 경로는 상태에 저장되어 애니메이션에 사용됩니다.

### 4.3 경로 애니메이션 처리 (LadderGamePaths 컴포넌트)

- Canvas API와 requestAnimationFrame을 활용해 경로를 점진적으로 그립니다.

- 경로의 각 구간을 보간하여 부드럽게 이동하는 애니메이션을 구현합니다.

- 캔버스는 매 프레임 초기화 후, 현재까지 그려진 경로와 진행 중인 구간을 다시 그립니다.

### 4.4 당첨자 랜덤 선정 (generateWinners)

- 참가자 수에 맞는 배열을 만들고,

- 무작위로 true(당첨), false(미당첨)을 할당

- 목표한 당첨자 수에 도달할 때까지 반복

- 배열 전체를 순회하면서 분포를 균등하게 섞는 구조

## 5. 시연 이미지

![초기 설정 화면](https://github.com/user-attachments/assets/ba384af8-7379-44f7-8392-2b9d3d45ae17)

![사다리와 당첨 결과](https://github.com/user-attachments/assets/3614cd4a-f4c7-450a-bd6a-0c6e36233c8b)

![경로 이동 애니메이션](https://github.com/user-attachments/assets/03dc072b-f4d0-47ca-bf58-960543503649)

## 6. 트러블슈팅 사례

### 6.1 LadderGame의 사다리가 클론 카드 내부에서 위치가 맞지 않는 문제 해결

**원인**

- 사다리 위치는 LadderGameSelector 버튼의 중심 좌표를 기준으로 계산됩니다.
- 기존에는 캔버스와 버튼이 동일한 부모 컨테이너에 있어 위치가 맞았으나,
- 클론 카드 내부로 이동하면서 캔버스와 버튼의 좌표 기준이 달라져 라인 위치가 어긋나는 문제가 발생했습니다.

**해결 방법**

- `getBoundingClientRect()`를 사용해 버튼의 뷰포트 절대 좌표를 구하고,
- 캔버스가 위치한 컨테이너의 오프셋을 보정하여 캔버스 기준의 상대 좌표로 변환하였습니다.
- 이를 통해 사다리 라인의 위치를 정확하게 맞출 수 있었습니다.

---

### 6.2 캔버스 초기화가 되지 않는 문제 해결

**원인**

- 상태만 초기화하고 캔버스 자체는 초기화하지 않아 발생
- 사다리 위치나 경로 관련 상태는 초기화했지만, 캔버스에 직접 그려진 내용은 지우지 않음
- 초기화 함수 내에 `clearRect` 호출 등 캔버스 초기화 코드가 누락되어 있었음

**해결 방법**

- 상태 초기화와 함께 캔버스도 명시적으로 초기화하도록 수정
- `clearRect` 메서드를 사용해 기존에 그려진 내용을 지움
- 캔버스 ref 또는 context에 접근할 수 있도록 초기화 함수 구조를 개선함

---

### 6.3 사다리와 경로가 반응형 디자인에 적용되지 않는 문제

**원인**

- 반응형 디자인 적용 이후에도 Selector 위치를 기존 방식인 브라우저 기준 절대 좌표로 계산하여 발생
- 기존에는 `window.innerWidth`를 기준으로 X 좌표를 보정했으나,
- 반응형 환경에서는 부모 컨테이너(`containerRef`) 기준으로 좌표를 계산해야 함

**문제점**

- 화면 너비(`window.innerWidth`) 기준으로 위치를 보정해 반응형 레이아웃에 부적합함

**해결 방법**

- `containerRef`를 사용해 부모 컨테이너 기준 좌표로 보정
- 브라우저 기준이 아닌 캔버스 내부 좌표계를 기준으로 위치를 계산하도록 수정

## 7. 프로젝트를 통해 배운 점

- Canvas API와 requestAnimationFrame을 활용한 애니메이션 처리 방법
- BFS/DFS와 Greedy 알고리즘의 탐색 방식 차이와 문제 유형에 따른 적합성 이해
- 알고리즘을 단순히 구현하는 것을 넘어, 실제 인터랙션 및 UX에 어떻게 적용할지 고민하는 과정의 중요성
- React의 상태 관리와 커스텀 훅을 활용한 로직 분리의 장점
